{"version":3,"file":"orders.js","sources":["pages/customer/orders.vue","../HX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY3VzdG9tZXIvb3JkZXJzLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"orders-page\">\r\n    <!-- 订单状态筛选 -->\r\n    <view class=\"status-filter\">\r\n      <view \r\n        class=\"filter-item\" \r\n        :class=\"{ 'active': selectedStatus === '' }\" \r\n        @click=\"selectStatus('')\"\r\n      >\r\n        全部\r\n      </view>\r\n      <view \r\n        class=\"filter-item\" \r\n        :class=\"{ 'active': selectedStatus === 'pending' }\" \r\n        @click=\"selectStatus('pending')\"\r\n      >\r\n        待确认\r\n      </view>\r\n      <view \r\n        class=\"filter-item\" \r\n        :class=\"{ 'active': selectedStatus === 'confirmed' }\" \r\n        @click=\"selectStatus('confirmed')\"\r\n      >\r\n        已确认\r\n      </view>\r\n      <view \r\n        class=\"filter-item\" \r\n        :class=\"{ 'active': selectedStatus === 'completed' }\" \r\n        @click=\"selectStatus('completed')\"\r\n      >\r\n        已完成\r\n      </view>\r\n      <view \r\n        class=\"filter-item\" \r\n        :class=\"{ 'active': selectedStatus === 'canceled' }\" \r\n        @click=\"selectStatus('canceled')\"\r\n      >\r\n        已取消\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 订单列表 -->\r\n    <view class=\"order-list\">\r\n      <block v-if=\"orderList.length > 0\">\r\n        <view class=\"order-item\" v-for=\"order in orderList\" :key=\"order.id\">\r\n          <!-- 商家信息 -->\r\n          <view class=\"merchant-info\">\r\n            <view class=\"merchant-name\">{{ order.merchantName }}</view>\r\n            <view class=\"order-status\" :class=\"order.status\">\r\n              {{ getStatusText(order.status) }}\r\n            </view>\r\n          </view>\r\n          \r\n          <!-- 服务信息 -->\r\n          <view class=\"service-info\">\r\n            <view class=\"service-name\">{{ order.serviceName }}</view>\r\n            <view class=\"service-price\">¥{{ order.price }}</view>\r\n          </view>\r\n          \r\n          <!-- 预约信息 -->\r\n          <view class=\"booking-info\">\r\n            <view class=\"booking-date\">预约日期：{{ formatDate(order.date) }}</view>\r\n            <view class=\"booking-time\">预约时间：{{ order.time }}</view>\r\n            <view class=\"contact-info\">联系人：{{ order.contactName }}（{{ order.contactPhone }}）</view>\r\n          </view>\r\n          \r\n          <!-- 订单操作 -->\r\n          <view class=\"order-actions\" v-if=\"order.status === 'pending'\">\r\n            <u-button @click=\"cancelOrder(order.id)\" type=\"text\" class=\"cancel-btn\">取消预约</u-button>\r\n          </view>\r\n          \r\n          <view class=\"order-actions\" v-else-if=\"order.status === 'confirmed'\">\r\n            <u-button @click=\"contactMerchant(order)\" type=\"text\" class=\"contact-btn\">联系商家</u-button>\r\n          </view>\r\n          \r\n          <view class=\"order-actions\" v-else-if=\"order.status === 'completed'\">\r\n            <u-button @click=\"viewService(order.serviceId)\" type=\"text\" class=\"view-btn\">查看服务</u-button>\r\n          </view>\r\n        </view>\r\n      </block>\r\n      <view v-else class=\"empty-tip\">\r\n        <text>暂无订单</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 加载中 -->\r\n    <view v-if=\"loading\" class=\"loading\">\r\n      <text>加载中...</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watchEffect } from 'vue'\r\nimport { orderService } from '../../utils/mockService.js'\r\n\r\nconst orderList = ref([])\r\nconst loading = ref(false)\r\nconst selectedStatus = ref('')\r\nconst currentUser = ref(null)\r\n\r\n// 格式化日期显示\r\nconst formatDate = (dateString) => {\r\n  if (!dateString) return ''\r\n  const date = new Date(dateString)\r\n  const year = date.getFullYear()\r\n  const month = (date.getMonth() + 1).toString().padStart(2, '0')\r\n  const day = date.getDate().toString().padStart(2, '0')\r\n  return `${year}-${month}-${day}`\r\n}\r\n\r\n// 获取状态文本\r\nconst getStatusText = (status) => {\r\n  const statusMap = {\r\n    pending: '待确认',\r\n    confirmed: '已确认',\r\n    completed: '已完成',\r\n    canceled: '已取消'\r\n  }\r\n  return statusMap[status] || status\r\n}\r\n\r\n// 获取订单列表\r\nconst fetchOrderList = async (status = '') => {\r\n  if (loading.value) return\r\n  \r\n  loading.value = true\r\n  \r\n  try {\r\n    const res = await orderService.getMyOrders(status)\r\n    \r\n    if (res.success) {\r\n      orderList.value = res.data.list || res.data\r\n    } else {\r\n      orderList.value = []\r\n      uni.showToast({ title: '获取订单列表失败', icon: 'none' })\r\n    }\r\n  } catch (error) {\r\n    console.error('获取订单列表失败', error)\r\n    uni.showToast({ title: '获取订单列表失败', icon: 'none' })\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 选择状态\r\nconst selectStatus = (status) => {\r\n  selectedStatus.value = status\r\n  fetchOrderList(status)\r\n}\r\n\r\n// 取消订单\r\nconst cancelOrder = async (orderId) => {\r\n  uni.showModal({\r\n    title: '取消预约',\r\n    content: '确定要取消此预约吗？',\r\n    success: async (res) => {\r\n      if (res.confirm) {\r\n        try {\r\n          const result = await orderService.updateOrderStatus(orderId, 'canceled')\r\n          if (result.success) {\r\n            uni.showToast({ title: '取消成功', icon: 'success' })\r\n            // 刷新订单列表\r\n            fetchOrderList(selectedStatus.value)\r\n          } else {\r\n            uni.showToast({ title: result.message || '取消失败', icon: 'none' })\r\n          }\r\n        } catch (error) {\r\n          uni.showToast({ title: '操作失败', icon: 'none' })\r\n        }\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n// 联系商家\r\nconst contactMerchant = (merchantId) => {\r\n  uni.makePhoneCall({\r\n    phoneNumber: '400-123-4567', // 模拟商家电话\r\n    success: () => {\r\n      console.log('拨打电话成功')\r\n    },\r\n    fail: () => {\r\n      console.log('拨打电话失败')\r\n    }\r\n  })\r\n}\r\n\r\n// 查看服务详情\r\nconst viewService = (serviceId) => {\r\n  uni.navigateTo({\r\n    url: `/pages/customer/service-detail?id=${serviceId}`\r\n  })\r\n}\r\n\r\n// 使用watchEffect替代onLoad，在组件初始化时执行\r\nwatchEffect(() => {\r\n  fetchOrderList()\r\n})\r\n\r\n// 直接定义onShow函数，不需要从vue导入\r\nonShow(() => {\r\n  fetchOrderList(selectedStatus.value)\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.orders-page {\r\n  padding-bottom: 20rpx;\r\n}\r\n\r\n.status-filter {\r\n  display: flex;\r\n  background-color: #fff;\r\n  padding: 20rpx 0;\r\n  border-bottom: 1rpx solid #eee;\r\n  overflow-x: auto;\r\n}\r\n\r\n.filter-item {\r\n  flex: 1;\r\n  text-align: center;\r\n  padding: 16rpx 0;\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  min-width: 140rpx;\r\n}\r\n\r\n.filter-item.active {\r\n  color: #1989fa;\r\n  font-weight: bold;\r\n  border-bottom: 4rpx solid #1989fa;\r\n}\r\n\r\n.order-list {\r\n  padding: 20rpx;\r\n}\r\n\r\n.order-item {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 24rpx;\r\n  margin-bottom: 20rpx;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.merchant-info {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.merchant-name {\r\n  font-size: 30rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.order-status {\r\n  font-size: 26rpx;\r\n  padding: 4rpx 16rpx;\r\n  border-radius: 16rpx;\r\n}\r\n\r\n.order-status.pending {\r\n  background-color: #fff0e6;\r\n  color: #ff6b3b;\r\n}\r\n\r\n.order-status.confirmed {\r\n  background-color: #e6f7ff;\r\n  color: #1890ff;\r\n}\r\n\r\n.order-status.completed {\r\n  background-color: #f6ffed;\r\n  color: #52c41a;\r\n}\r\n\r\n.order-status.canceled {\r\n  background-color: #f5f5f5;\r\n  color: #999;\r\n}\r\n\r\n.service-info {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20rpx 0;\r\n  border-top: 1rpx solid #f0f0f0;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.service-name {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.service-price {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #E64340;\r\n}\r\n\r\n.booking-info {\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.booking-date,\r\n.booking-time,\r\n.contact-info {\r\n  font-size: 26rpx;\r\n  color: #666;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.order-actions {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 20rpx;\r\n}\r\n\r\n.cancel-btn {\r\n  color: #999;\r\n  border: 1rpx solid #ddd;\r\n}\r\n\r\n.contact-btn {\r\n  color: #1989fa;\r\n  border: 1rpx solid #1989fa;\r\n}\r\n\r\n.view-btn {\r\n  color: #1989fa;\r\n}\r\n\r\n.empty-tip {\r\n  padding: 100rpx 0;\r\n  text-align: center;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.loading {\r\n  padding: 20rpx 0;\r\n  text-align: center;\r\n  color: #999;\r\n  font-size: 28rpx;\r\n}\r\n</style>","import MiniProgramPage from 'F:/demo/pages/customer/orders.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","orderService","uni","watchEffect"],"mappings":";;;;;;;;;;AAgGA,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,iBAAiBA,cAAG,IAAC,EAAE;AACTA,kBAAG,IAAC,IAAI;AAG5B,UAAM,aAAa,CAAC,eAAe;AACjC,UAAI,CAAC;AAAY,eAAO;AACxB,YAAM,OAAO,IAAI,KAAK,UAAU;AAChC,YAAM,OAAO,KAAK,YAAa;AAC/B,YAAM,SAAS,KAAK,SAAU,IAAG,GAAG,WAAW,SAAS,GAAG,GAAG;AAC9D,YAAM,MAAM,KAAK,QAAS,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AACrD,aAAO,GAAG,IAAI,IAAI,KAAK,IAAI,GAAG;AAAA,IAChC;AAGA,UAAM,gBAAgB,CAAC,WAAW;AAChC,YAAM,YAAY;AAAA,QAChB,SAAS;AAAA,QACT,WAAW;AAAA,QACX,WAAW;AAAA,QACX,UAAU;AAAA,MACX;AACD,aAAO,UAAU,MAAM,KAAK;AAAA,IAC9B;AAGA,UAAM,iBAAiB,OAAO,SAAS,OAAO;AAC5C,UAAI,QAAQ;AAAO;AAEnB,cAAQ,QAAQ;AAEhB,UAAI;AACF,cAAM,MAAM,MAAMC,+BAAa,YAAY,MAAM;AAEjD,YAAI,IAAI,SAAS;AACf,oBAAU,QAAQ,IAAI,KAAK,QAAQ,IAAI;AAAA,QAC7C,OAAW;AACL,oBAAU,QAAQ,CAAE;AACpBC,wBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,QAClD;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAA,MAAA,SAAA,oCAAc,YAAY,KAAK;AAC/BA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,MACrD,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGA,UAAM,eAAe,CAAC,WAAW;AAC/B,qBAAe,QAAQ;AACvB,qBAAe,MAAM;AAAA,IACvB;AAGA,UAAM,cAAc,OAAO,YAAY;AACrCA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,OAAO,QAAQ;AACtB,cAAI,IAAI,SAAS;AACf,gBAAI;AACF,oBAAM,SAAS,MAAMD,kBAAAA,aAAa,kBAAkB,SAAS,UAAU;AACvE,kBAAI,OAAO,SAAS;AAClBC,8BAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAEhD,+BAAe,eAAe,KAAK;AAAA,cAC/C,OAAiB;AACLA,oCAAI,UAAU,EAAE,OAAO,OAAO,WAAW,QAAQ,MAAM,QAAQ;AAAA,cAChE;AAAA,YACF,SAAQ,OAAO;AACdA,4BAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,YAC9C;AAAA,UACF;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,kBAAkB,CAAC,eAAe;AACtCA,oBAAAA,MAAI,cAAc;AAAA,QAChB,aAAa;AAAA;AAAA,QACb,SAAS,MAAM;AACbA,wBAAAA,MAAY,MAAA,OAAA,oCAAA,QAAQ;AAAA,QACrB;AAAA,QACD,MAAM,MAAM;AACVA,wBAAAA,MAAY,MAAA,OAAA,oCAAA,QAAQ;AAAA,QACrB;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,cAAc,CAAC,cAAc;AACjCA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,qCAAqC,SAAS;AAAA,MACvD,CAAG;AAAA,IACH;AAGAC,kBAAAA,YAAY,MAAM;AAChB,qBAAgB;AAAA,IAClB,CAAC;AAGD,WAAO,MAAM;AACX,qBAAe,eAAe,KAAK;AAAA,IACrC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1MD,GAAG,WAAW,eAAe;"}