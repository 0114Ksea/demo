{"version":3,"file":"service-detail.js","sources":["pages/customer/service-detail.vue","../HX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY3VzdG9tZXIvc2VydmljZS1kZXRhaWwudnVl"],"sourcesContent":["<template>\r\n  <view class=\"service-detail\">\r\n    <!-- 服务图片轮播 -->\r\n    <view class=\"service-images\">\r\n      <image :src=\"service.image\" mode=\"aspectFill\"></image>\r\n    </view>\r\n    \r\n    <!-- 服务基本信息 -->\r\n    <view class=\"service-basic-info\">\r\n      <view class=\"service-name\">{{ service.name }}</view>\r\n      <view class=\"service-price\">¥{{ service.price }}</view>\r\n      <view class=\"service-stats\">\r\n        <text class=\"sales\">销量 {{ service.sales }}</text>\r\n        <text class=\"rating\">评分 {{ service.merchant.rating }}</text>\r\n        <text class=\"duration\">{{ service.duration }}分钟</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 商家信息 -->\r\n    <view class=\"merchant-info\">\r\n      <view class=\"merchant-header\">\r\n        <text class=\"merchant-name\">{{ service.merchant.name }}</text>\r\n        <text class=\"merchant-rating\">★ {{ service.merchant.rating }}</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 服务详情 -->\r\n    <view class=\"service-description\">\r\n      <view class=\"section-title\">服务详情</view>\r\n      <view class=\"description-content\">{{ service.description }}</view>\r\n    </view>\r\n    \r\n    <!-- 底部预约栏 -->\r\n    <view class=\"bottom-bar\">\r\n      <view class=\"bottom-left\">\r\n        <view class=\"price\">¥{{ service.price }}</view>\r\n        <text class=\"unit\">/次</text>\r\n      </view>\r\n      <view class=\"bottom-right\">\r\n        <u-button :loading=\"isFavoriteLoading\" @click=\"toggleFavorite\" type=\"text\" class=\"favorite-btn\">\r\n          <text :class=\"isFavorite ? 'active' : ''\">★</text>\r\n          <text>{{ isFavorite ? '已收藏' : '收藏' }}</text>\r\n        </u-button>\r\n        <u-button :loading=\"bookingLoading\" @click=\"goToBooking\" type=\"primary\" class=\"booking-btn\">立即预约</u-button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { serviceService, favoriteService } from '../../utils/mockService.js'\r\n\r\nconst service = ref({\r\n  id: '',\r\n  name: '',\r\n  price: 0,\r\n  duration: 0,\r\n  image: '',\r\n  description: '',\r\n  merchant: {\r\n    id: '',\r\n    name: '',\r\n    rating: 0\r\n  },\r\n  sales: 0\r\n})\r\n\r\nconst loading = ref(false)\r\nconst bookingLoading = ref(false)\r\nconst isFavorite = ref(false)\r\nconst isFavoriteLoading = ref(false)\r\nconst currentUser = ref(null)\r\n\r\n// 获取服务详情\r\nconst fetchServiceDetail = async (serviceId) => {\r\n  if (loading.value) return\r\n  \r\n  loading.value = true\r\n  \r\n  try {\r\n    const res = await serviceService.getServiceDetail(serviceId)\r\n    if (res.success) {\r\n      service.value = res.data\r\n      \r\n      // 检查是否已收藏\r\n      await checkFavoriteStatus(serviceId)\r\n    } else {\r\n      uni.showToast({ title: '获取服务详情失败', icon: 'none' })\r\n      setTimeout(() => {\r\n        uni.navigateBack()\r\n      }, 1500)\r\n    }\r\n  } catch (error) {\r\n    console.error('获取服务详情失败', error)\r\n    uni.showToast({ title: '获取服务详情失败', icon: 'none' })\r\n    loading.value = false\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 检查收藏状态\r\nconst checkFavoriteStatus = async (serviceId) => {\r\n  try {\r\n    const app = getApp()\r\n    if (app.globalData.isLogin && app.globalData.userInfo) {\r\n      const res = await favoriteService.checkFavorite(serviceId)\r\n      isFavorite.value = res.success && res.data\r\n    }\r\n  } catch (error) {\r\n    console.error('检查收藏状态失败', error)\r\n  }\r\n}\r\n\r\n// 切换收藏状态\r\nconst toggleFavorite = async () => {\r\n  if (isFavoriteLoading.value) return\r\n  \r\n  const app = getApp()\r\n  if (!app.globalData.isLogin) {\r\n    uni.showToast({ title: '请先登录', icon: 'none' })\r\n    setTimeout(() => {\r\n      uni.navigateTo({ url: '/pages/auth/login' })\r\n    }, 1000)\r\n    return\r\n  }\r\n  \r\n  isFavoriteLoading.value = true\r\n  \r\n  try {\r\n    const res = await favoriteService.toggleFavorite(service.value.id)\r\n    if (res.success) {\r\n      isFavorite.value = res.data\r\n      uni.showToast({\r\n        title: isFavorite.value ? '收藏成功' : '取消收藏',\r\n        icon: 'success'\r\n      })\r\n    } else {\r\n      uni.showToast({ title: res.message || '操作失败', icon: 'none' })\r\n    }\r\n  } catch (error) {\r\n    console.error('操作失败', error)\r\n    uni.showToast({ title: '操作失败', icon: 'none' })\r\n  } finally {\r\n    isFavoriteLoading.value = false\r\n  }\r\n}\r\n\r\n// 跳转到预约页面\r\nconst goToBooking = async () => {\r\n  if (bookingLoading.value) return\r\n  \r\n  bookingLoading.value = true\r\n  \r\n  try {\r\n    // 检查登录状态\r\n    const app = getApp()\r\n    if (!app.globalData.isLogin) {\r\n      uni.showToast({ title: '请先登录', icon: 'none' })\r\n      setTimeout(() => {\r\n        uni.navigateTo({ url: '/pages/auth/login' })\r\n      }, 1000)\r\n      return\r\n    }\r\n    \r\n    // 跳转到预约页面\r\n    uni.navigateTo({\r\n      url: `/pages/customer/booking?id=${service.value.id}`\r\n    })\r\n  } catch (error) {\r\n    console.error('跳转失败', error)\r\n  } finally {\r\n    bookingLoading.value = false\r\n  }\r\n}\r\n\r\n// 页面加载时获取服务详情\r\nonLoad((options) => {\r\n  if (options && options.id) {\r\n    fetchServiceDetail(options.id)\r\n  } else {\r\n    uni.showToast({ title: '参数错误', icon: 'none' })\r\n    setTimeout(() => {\r\n      uni.navigateBack()\r\n    }, 1500)\r\n  }\r\n})\r\n\r\n// 页面显示时刷新收藏状态\r\nonShow(() => {\r\n  if (service.value.id) {\r\n    checkFavoriteStatus(service.value.id)\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.service-detail {\r\n  padding-bottom: 120rpx;\r\n}\r\n\r\n.service-images {\r\n  width: 100%;\r\n  height: 400rpx;\r\n  background-color: #f5f5f5;\r\n  overflow: hidden;\r\n}\r\n\r\n.service-images image {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.service-basic-info {\r\n  padding: 30rpx 20rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.service-name {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.service-price {\r\n  font-size: 42rpx;\r\n  font-weight: bold;\r\n  color: #E64340;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.service-stats {\r\n  display: flex;\r\n  font-size: 26rpx;\r\n  color: #999;\r\n}\r\n\r\n.service-stats text {\r\n  margin-right: 30rpx;\r\n}\r\n\r\n.merchant-info {\r\n  padding: 20rpx;\r\n  margin-top: 20rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.merchant-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.merchant-name {\r\n  font-size: 30rpx;\r\n  color: #333;\r\n}\r\n\r\n.merchant-rating {\r\n  font-size: 26rpx;\r\n  color: #FF9500;\r\n}\r\n\r\n.service-description {\r\n  margin-top: 20rpx;\r\n  padding: 20rpx;\r\n  background-color: #fff;\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.description-content {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  line-height: 1.6;\r\n}\r\n\r\n.bottom-bar {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 120rpx;\r\n  background-color: #fff;\r\n  border-top: 1rpx solid #eee;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 20rpx;\r\n}\r\n\r\n.bottom-left {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: baseline;\r\n}\r\n\r\n.price {\r\n  font-size: 42rpx;\r\n  font-weight: bold;\r\n  color: #E64340;\r\n}\r\n\r\n.unit {\r\n  font-size: 26rpx;\r\n  color: #999;\r\n  margin-left: 8rpx;\r\n}\r\n\r\n.bottom-right {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.favorite-btn {\r\n  color: #999;\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.favorite-btn .active {\r\n  color: #FF9500;\r\n}\r\n\r\n.booking-btn {\r\n  width: 280rpx;\r\n}\r\n</style>```","import MiniProgramPage from 'F:/demo/pages/customer/service-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","serviceService","uni","favoriteService"],"mappings":"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"}