{"version":3,"file":"login.js","sources":["pages/auth/login.vue","../HX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYXV0aC9sb2dpbi52dWU"],"sourcesContent":["<template>\r\n  <view class=\"login-container\">\r\n    <view class=\"logo\">\r\n      <!-- <image src=\"/static/logo.png\" mode=\"aspectFit\"></image> -->\r\n    </view>\r\n    <view class=\"form-group\">\r\n      <input v-model=\"phone\" type=\"number\" placeholder=\"请输入手机号\" class=\"input\" />\r\n    </view>\r\n    <view class=\"form-group\">\r\n      <input v-model=\"code\" type=\"number\" placeholder=\"请输入验证码\" class=\"input code-input\" />\r\n      <button class=\"code-btn\" @click=\"sendCode\" :disabled=\"countdown > 0\">\r\n        {{ countdown > 0 ? `${countdown}秒后重新获取` : '获取验证码' }}\r\n      </button>\r\n    </view>\r\n    <button class=\"login-btn\" @click=\"login\" :disabled=\"!canLogin\">登录</button>\r\n    <view class=\"link-group\">\r\n      <text @click=\"goToRegister\" class=\"link\">注册</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue'\r\nimport { authService } from '../../utils/mockService.js'\r\n\r\n// 页面参数\r\nconst phone = ref('')\r\nconst code = ref('')\r\nconst countdown = ref(0)\r\n\r\n// 计算是否可以登录\r\nconst canLogin = computed(() => {\r\n  return phone.value.length === 11 && code.value.length > 0\r\n})\r\n\r\n// 发送验证码\r\nconst sendCode = async () => {\r\n  if (phone.value.length !== 11) {\r\n    uni.showToast({ title: '请输入正确的手机号', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  try {\r\n    await authService.sendCode(phone.value)\r\n    uni.showToast({ title: '验证码发送成功', icon: 'success' })\r\n    // 开始倒计时\r\n    startCountdown()\r\n  } catch (error) {\r\n    uni.showToast({ title: error.message || '验证码发送失败', icon: 'none' })\r\n  }\r\n}\r\n\r\n// 开始倒计时\r\nconst startCountdown = () => {\r\n  countdown.value = 60\r\n  const timer = setInterval(() => {\r\n    countdown.value--\r\n    if (countdown.value <= 0) {\r\n      clearInterval(timer)\r\n    }\r\n  }, 1000)\r\n}\r\n\r\n// 登录\r\nconst login = async () => {\r\n  if (!canLogin.value) {\r\n    return\r\n  }\r\n  \r\n  try {\r\n    uni.showLoading({ title: '登录中...' })\r\n    const result = await authService.login(phone.value, code.value)\r\n    \r\n    // 保存登录状态\r\n    uni.setStorageSync('token', result.token)\r\n    uni.setStorageSync('userInfo', result.userInfo)\r\n    \r\n    // 更新全局登录状态\r\n    if (result.success) {\r\n  getApp().globalData.isLogin = true\r\n  getApp().globalData.userInfo = result.data.userInfo\r\n  getApp().globalData.role = result.data.userInfo.role\r\n  \r\n  // 保存登录状态到本地存储\r\n  uni.setStorageSync('token', result.data.token)\r\n  uni.setStorageSync('userInfo', result.data.userInfo)\r\n  \r\n  uni.hideLoading()\r\n  uni.showToast({ title: '登录成功', icon: 'success' })\r\n  \r\n  // 统一跳转到服务列表页面\r\n  uni.switchTab({ url: '/pages/customer/services' })\r\n}\r\n    \r\n    uni.hideLoading()\r\n    uni.showToast({ title: '登录成功', icon: 'success' })\r\n    \r\n    // 统一跳转到服务列表页面，因为商家页面不存在\r\n    uni.switchTab({ url: '/pages/customer/services' })\r\n  } catch (error) {\r\n    uni.hideLoading()\r\n    uni.showToast({ title: error.message || '登录失败', icon: 'none' })\r\n  }\r\n}\r\n\r\n// 跳转到注册页面\r\nconst goToRegister = () => {\r\n  uni.navigateTo({ url: '/pages/auth/register' })\r\n}\r\n</script>\r\n\r\n<style>\r\n.login-container {\r\n  padding: 60rpx 40rpx;\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.logo {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin: 40rpx 0;\r\n}\r\n\r\n.logo image {\r\n  width: 180rpx;\r\n  height: 180rpx;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 40rpx;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.input {\r\n  flex: 1;\r\n  height: 90rpx;\r\n  border: 1px solid #e4e7ed;\r\n  border-radius: 8rpx;\r\n  padding: 0 24rpx;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.code-input {\r\n  margin-right: 20rpx;\r\n}\r\n\r\n.code-btn {\r\n  width: 220rpx;\r\n  height: 90rpx;\r\n  line-height: 90rpx;\r\n  font-size: 26rpx;\r\n  color: #1989fa;\r\n  background-color: transparent;\r\n  border: none;\r\n}\r\n\r\n.login-btn {\r\n  height: 96rpx;\r\n  line-height: 96rpx;\r\n  font-size: 32rpx;\r\n  background-color: #1989fa;\r\n  color: #fff;\r\n  border-radius: 48rpx;\r\n  margin-top: 60rpx;\r\n}\r\n\r\n.link-group {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-top: 40rpx;\r\n  font-size: 28rpx;\r\n  color: #666;\r\n}\r\n\r\n.link {\r\n  color: #1989fa;\r\n  margin: 0 20rpx;\r\n}\r\n\r\n.split {\r\n  color: #e4e7ed;\r\n}\r\n</style>","import MiniProgramPage from 'F:/demo/pages/auth/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","uni","authService","MiniProgramPage"],"mappings":";;;;;;AA0BA,UAAM,QAAQA,cAAG,IAAC,EAAE;AACpB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,YAAYA,cAAG,IAAC,CAAC;AAGvB,UAAM,WAAWC,cAAQ,SAAC,MAAM;AAC9B,aAAO,MAAM,MAAM,WAAW,MAAM,KAAK,MAAM,SAAS;AAAA,IAC1D,CAAC;AAGD,UAAM,WAAW,YAAY;AAC3B,UAAI,MAAM,MAAM,WAAW,IAAI;AAC7BC,sBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,QAAQ;AAClD;AAAA,MACD;AAED,UAAI;AACF,cAAMC,8BAAY,SAAS,MAAM,KAAK;AACtCD,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,WAAW;AAEnD,uBAAgB;AAAA,MACjB,SAAQ,OAAO;AACdA,4BAAI,UAAU,EAAE,OAAO,MAAM,WAAW,WAAW,MAAM,QAAQ;AAAA,MAClE;AAAA,IACH;AAGA,UAAM,iBAAiB,MAAM;AAC3B,gBAAU,QAAQ;AAClB,YAAM,QAAQ,YAAY,MAAM;AAC9B,kBAAU;AACV,YAAI,UAAU,SAAS,GAAG;AACxB,wBAAc,KAAK;AAAA,QACpB;AAAA,MACF,GAAE,GAAI;AAAA,IACT;AAGA,UAAM,QAAQ,YAAY;AACxB,UAAI,CAAC,SAAS,OAAO;AACnB;AAAA,MACD;AAED,UAAI;AACFA,sBAAAA,MAAI,YAAY,EAAE,OAAO,SAAQ,CAAE;AACnC,cAAM,SAAS,MAAMC,8BAAY,MAAM,MAAM,OAAO,KAAK,KAAK;AAG9DD,sBAAAA,MAAI,eAAe,SAAS,OAAO,KAAK;AACxCA,sBAAAA,MAAI,eAAe,YAAY,OAAO,QAAQ;AAG9C,YAAI,OAAO,SAAS;AACtB,iBAAQ,EAAC,WAAW,UAAU;AAC9B,iBAAQ,EAAC,WAAW,WAAW,OAAO,KAAK;AAC3C,iBAAM,EAAG,WAAW,OAAO,OAAO,KAAK,SAAS;AAGhDA,wBAAAA,MAAI,eAAe,SAAS,OAAO,KAAK,KAAK;AAC7CA,wBAAAA,MAAI,eAAe,YAAY,OAAO,KAAK,QAAQ;AAEnDA,wBAAAA,MAAI,YAAa;AACjBA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAGhDA,wBAAAA,MAAI,UAAU,EAAE,KAAK,2BAA0B,CAAE;AAAA,QACnD;AAEIA,sBAAAA,MAAI,YAAa;AACjBA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAGhDA,sBAAAA,MAAI,UAAU,EAAE,KAAK,2BAA0B,CAAE;AAAA,MAClD,SAAQ,OAAO;AACdA,sBAAAA,MAAI,YAAa;AACjBA,4BAAI,UAAU,EAAE,OAAO,MAAM,WAAW,QAAQ,MAAM,QAAQ;AAAA,MAC/D;AAAA,IACH;AAGA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,WAAW,EAAE,KAAK,uBAAsB,CAAE;AAAA,IAChD;;;;;;;;;;;;;;;;;AC3GA,GAAG,WAAWE,SAAe;"}