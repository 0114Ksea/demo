{"version":3,"file":"register.js","sources":["pages/auth/register.vue","../HX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYXV0aC9yZWdpc3Rlci52dWU"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <view class=\"logo-container\">\r\n      <!-- <image class=\"logo\" src=\"/static/logo.png\"></image> -->\r\n      <view class=\"title\">账号注册</view>\r\n    </view>\r\n    \r\n    <view class=\"form-container\">\r\n      <!-- 使用普通的input组件代替u-input，确保兼容性 -->\r\n      <input v-model=\"phone\" placeholder=\"请输入手机号码\" type=\"number\" maxlength=\"11\" class=\"custom-input\" />\r\n      \r\n      <view class=\"code-input-container\">\r\n        <input v-model=\"code\" placeholder=\"请输入验证码\" type=\"number\" maxlength=\"6\" class=\"custom-input code-input\" />\r\n        <button :disabled=\"countDown > 0\" @click=\"sendCode\" class=\"code-btn\">{{ countDown > 0 ? `${countDown}秒后重发` : '获取验证码' }}</button>\r\n      </view>\r\n      \r\n      <button @click=\"register\" class=\"register-btn\">注册并登录</button>\r\n      \r\n      <view class=\"role-selector\">\r\n        <text :class=\"[role === 'customer' ? 'active' : '']\" @click=\"selectRole('customer')\">顾客</text>\r\n        <text class=\"divider\">|</text>\r\n        <text :class=\"[role === 'merchant' ? 'active' : '']\" @click=\"selectRole('merchant')\">商家</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { authService } from '../../utils/mockService.js'\r\n\r\nconst phone = ref('')\r\nconst code = ref('')\r\nconst countDown = ref(0)\r\nconst role = ref('customer') // 默认顾客注册\r\n\r\n// 发送验证码\r\nconst sendCode = async () => {\r\n  // 验证手机号\r\n  if (!phone.value || phone.value.length !== 11) {\r\n    uni.showToast({ title: '请输入正确的手机号码', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  try {\r\n    // 调用发送验证码服务\r\n    const res = await authService.sendCode(phone.value)\r\n    if (res.success) {\r\n      uni.showToast({ title: '验证码发送成功' })\r\n      // 开始倒计时\r\n      startCountDown()\r\n    } else {\r\n      uni.showToast({ title: res.message || '发送失败', icon: 'none' })\r\n    }\r\n  } catch (error) {\r\n    console.error('发送验证码失败', error)\r\n    uni.showToast({ title: '发送失败，请重试', icon: 'none' })\r\n  }\r\n}\r\n\r\n// 倒计时函数\r\nconst startCountDown = () => {\r\n  countDown.value = 60\r\n  const timer = setInterval(() => {\r\n    countDown.value--\r\n    if (countDown.value <= 0) {\r\n      clearInterval(timer)\r\n    }\r\n  }, 1000)\r\n}\r\n\r\n// 注册函数\r\nconst register = async () => {\r\n  // 验证表单\r\n  if (!phone.value || phone.value.length !== 11) {\r\n    uni.showToast({ title: '请输入正确的手机号码', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  if (!code.value || code.value.length !== 6) {\r\n    uni.showToast({ title: '请输入6位验证码', icon: 'none' })\r\n    return\r\n  }\r\n  \r\n  try {\r\n    // 调用注册服务\r\n    const res = await authService.register(phone.value, code.value, role.value)\r\n    if (res.success) {\r\n      // 设置全局登录状态\r\n      const app = getApp()\r\n      app.globalData.isLogin = true\r\n      app.globalData.userInfo = res.data.userInfo\r\n      app.globalData.role = res.data.userInfo.role\r\n      \r\n      // 保存登录状态到本地存储\r\n      uni.setStorageSync('token', res.data.token)\r\n      uni.setStorageSync('userInfo', res.data.userInfo)\r\n      \r\n      uni.showToast({ title: '注册成功' })\r\n      \r\n      // 统一跳转到服务列表页面，因为商家页面不存在\r\n      setTimeout(() => {\r\n        uni.switchTab({ url: '/pages/customer/services' })\r\n      }, 1500)\r\n    } else {\r\n      uni.showToast({ title: res.message || '注册失败', icon: 'none' })\r\n    }\r\n  } catch (error) {\r\n    console.error('注册失败', error)\r\n    uni.showToast({ title: '注册失败，请重试', icon: 'none' })\r\n  }\r\n}\r\n\r\n// 选择角色\r\nconst selectRole = (selectedRole) => {\r\n  role.value = selectedRole\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 80rpx 40rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  height: 100vh;\r\n  box-sizing: border-box;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.logo-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-bottom: 80rpx;\r\n}\r\n\r\n.logo {\r\n  width: 200rpx;\r\n  height: 200rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 44rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.form-container {\r\n  width: 100%;\r\n  width: 100%;\r\n}\r\n\r\n/* 为自定义输入框添加样式 */\r\n.custom-input {\r\n  width: 100%;\r\n  height: 90rpx;\r\n  border: 1px solid #e4e7ed;\r\n  border-radius: 8rpx;\r\n  padding: 0 24rpx;\r\n  font-size: 28rpx;\r\n  margin-bottom: 30rpx;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.code-input-container {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 50rpx;\r\n}\r\n\r\n.code-input {\r\n  flex: 1;\r\n  margin-right: 20rpx;\r\n  margin-bottom: 0;\r\n}\r\n\r\n.code-btn {\r\n  flex: 0 0 auto;\r\n  color: #1989fa;\r\n  padding: 0 20rpx;\r\n  background: none;\r\n  border: none;\r\n  font-size: 26rpx;\r\n  height: 90rpx;\r\n  line-height: 90rpx;\r\n}\r\n\r\n.register-btn {\r\n  margin-bottom: 40rpx;\r\n  width: 100%;\r\n  height: 96rpx;\r\n  line-height: 96rpx;\r\n  background-color: #1989fa;\r\n  color: white;\r\n  border-radius: 48rpx;\r\n  border: none;\r\n  font-size: 32rpx;\r\n}\r\n\r\n.role-selector {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.role-selector text {\r\n  color: #666;\r\n  padding: 0 30rpx;\r\n}\r\n\r\n.role-selector .divider {\r\n  color: #ddd;\r\n}\r\n\r\n.role-selector .active {\r\n  color: #1989fa;\r\n  font-weight: bold;\r\n}\r\n</style>","import MiniProgramPage from 'F:/demo/pages/auth/register.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","authService"],"mappings":";;;;;;AA+BA,UAAM,QAAQA,cAAG,IAAC,EAAE;AACpB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,YAAYA,cAAG,IAAC,CAAC;AACvB,UAAM,OAAOA,cAAG,IAAC,UAAU;AAG3B,UAAM,WAAW,YAAY;AAE3B,UAAI,CAAC,MAAM,SAAS,MAAM,MAAM,WAAW,IAAI;AAC7CC,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AACnD;AAAA,MACD;AAED,UAAI;AAEF,cAAM,MAAM,MAAMC,kBAAAA,YAAY,SAAS,MAAM,KAAK;AAClD,YAAI,IAAI,SAAS;AACfD,wBAAAA,MAAI,UAAU,EAAE,OAAO,UAAS,CAAE;AAElC,yBAAgB;AAAA,QACtB,OAAW;AACLA,8BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,QAAQ;AAAA,QAC7D;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAA,MAAA,SAAA,iCAAc,WAAW,KAAK;AAC9BA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,MAClD;AAAA,IACH;AAGA,UAAM,iBAAiB,MAAM;AAC3B,gBAAU,QAAQ;AAClB,YAAM,QAAQ,YAAY,MAAM;AAC9B,kBAAU;AACV,YAAI,UAAU,SAAS,GAAG;AACxB,wBAAc,KAAK;AAAA,QACpB;AAAA,MACF,GAAE,GAAI;AAAA,IACT;AAGA,UAAM,WAAW,YAAY;AAE3B,UAAI,CAAC,MAAM,SAAS,MAAM,MAAM,WAAW,IAAI;AAC7CA,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AACnD;AAAA,MACD;AAED,UAAI,CAAC,KAAK,SAAS,KAAK,MAAM,WAAW,GAAG;AAC1CA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjD;AAAA,MACD;AAED,UAAI;AAEF,cAAM,MAAM,MAAMC,kBAAW,YAAC,SAAS,MAAM,OAAO,KAAK,OAAO,KAAK,KAAK;AAC1E,YAAI,IAAI,SAAS;AAEf,gBAAM,MAAM,OAAQ;AACpB,cAAI,WAAW,UAAU;AACzB,cAAI,WAAW,WAAW,IAAI,KAAK;AACnC,cAAI,WAAW,OAAO,IAAI,KAAK,SAAS;AAGxCD,wBAAAA,MAAI,eAAe,SAAS,IAAI,KAAK,KAAK;AAC1CA,wBAAAA,MAAI,eAAe,YAAY,IAAI,KAAK,QAAQ;AAEhDA,wBAAAA,MAAI,UAAU,EAAE,OAAO,OAAM,CAAE;AAG/B,qBAAW,MAAM;AACfA,0BAAAA,MAAI,UAAU,EAAE,KAAK,2BAA0B,CAAE;AAAA,UAClD,GAAE,IAAI;AAAA,QACb,OAAW;AACLA,8BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,QAAQ;AAAA,QAC7D;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,uDAAc,QAAQ,KAAK;AAC3BA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,MAClD;AAAA,IACH;AAGA,UAAM,aAAa,CAAC,iBAAiB;AACnC,WAAK,QAAQ;AAAA,IACf;;;;;;;;;;;;;;;;;;;;ACnHA,GAAG,WAAW,eAAe;"}